AWSTemplateFormatVersion: "2010-09-09"
Description: "Bootstrap stack for TMS backend â€“ creates IAM role with permissions to manage EKS and supporting resources."

Resources:
  TMSBackendRole:
    Type: AWS::IAM::Role
    Properties:
      RoleName: TMS-BackendRole
      AssumeRolePolicyDocument:
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Principal:
              Service:  
                - ec2.amazonaws.com 
                - ecs-tasks.amazonaws.com
                - eks.amazonaws.com
                - lambda.amazonaws.com
            Action: sts:AssumeRole
      ManagedPolicyArns:
        - arn:aws:iam::aws:policy/AmazonEKSClusterPolicy
        - arn:aws:iam::aws:policy/AmazonEKSServicePolicy
        - arn:aws:iam::aws:policy/AmazonEKSWorkerNodePolicy
        - arn:aws:iam::aws:policy/AmazonEC2FullAccess
        - arn:aws:iam::aws:policy/AmazonVPCFullAccess
        - arn:aws:iam::aws:policy/AutoScalingFullAccess
        - arn:aws:iam::aws:policy/AmazonSSMManagedInstanceCore
        - arn:aws:iam::aws:policy/IAMFullAccess

Outputs:
  BackendRoleArn:
    Description: "ARN of the IAM Role for the TMS backend running in this AWS account"
    Value: !GetAtt TMSBackendRole.Arn
